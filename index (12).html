<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulatore di Scenari - Marketing Funnel</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Lexend:wght@500;600;700&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Lexend', sans-serif;
        }
        
        /* Tailwind Custom Config */
        @layer utilities {
            .gradient-primary {
                background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            }
            .gradient-accent {
                background: linear-gradient(135deg, #06b6d4 0%, #14b8a6 100%);
            }
        }
        
        /* Custom Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-slide-in {
            animation: slideIn 0.5s ease-out forwards;
        }
        
        /* Custom Input Styles */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            opacity: 1;
        }
        
        /* Hover Effects */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* Gradient Border */
        .gradient-border {
            border-image: linear-gradient(135deg, #06b6d4, #14b8a6) 1;
        }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1e3a8a',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        accent: {
                            400: '#2dd4bf',
                            500: '#14b8a6',
                            600: '#0d9488',
                            700: '#0f766e',
                        },
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-cyan-50 min-h-screen">
    
    <!-- Header -->
    <header class="gradient-primary text-white shadow-2xl">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="bg-white/20 backdrop-blur-sm p-3 rounded-xl">
                        <i data-lucide="activity" class="w-8 h-8"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl lg:text-4xl font-bold tracking-tight">Simulatore di Scenari</h1>
                        <p class="text-blue-100 mt-1 text-sm lg:text-base">Modella le performance del tuo funnel di marketing</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 lg:py-12">
        
        <!-- Input Parameters Section -->
        <section class="mb-12 animate-slide-in">
            <div class="bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden">
                <div class="bg-gradient-to-r from-primary-700 to-indigo-700 px-6 py-5">
                    <div class="flex items-center space-x-3">
                        <div class="bg-white/20 p-2 rounded-lg">
                            <i data-lucide="settings" class="w-6 h-6 text-white"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-white">1. Parametri di Input</h2>
                    </div>
                </div>
                
                <div class="p-6 lg:p-8 space-y-8">
                    
                    <!-- Marketing Section -->
                    <div class="space-y-6">
                        <div class="flex items-center space-x-3 pb-3 border-b-2 border-cyan-500">
                            <i data-lucide="megaphone" class="w-6 h-6 text-cyan-600"></i>
                            <h3 class="text-xl font-semibold text-slate-800">Sezione Marketing</h3>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="group">
                                <label class="flex items-center space-x-2 text-sm font-medium text-slate-700 mb-2">
                                    <i data-lucide="dollar-sign" class="w-4 h-4 text-slate-500"></i>
                                    <span>Investimento Advertising (€)</span>
                                </label>
                                <input type="number" id="adv" value="5000" min="0" step="100"
                                    class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-4 focus:ring-cyan-100 focus:border-cyan-500 transition-all duration-200 outline-none hover:border-slate-300">
                            </div>
                            
                            <div class="group">
                                <label class="flex items-center space-x-2 text-sm font-medium text-slate-700 mb-2">
                                    <i data-lucide="trending-down" class="w-4 h-4 text-slate-500"></i>
                                    <span>Costo per Lead (CPL) (€)</span>
                                </label>
                                <input type="number" id="cpl" value="10" min="0.01" step="0.1"
                                    class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-4 focus:ring-cyan-100 focus:border-cyan-500 transition-all duration-200 outline-none hover:border-slate-300">
                            </div>
                            
                            <div class="group">
                                <label class="flex items-center space-x-2 text-sm font-medium text-slate-700 mb-2">
                                    <i data-lucide="users" class="w-4 h-4 text-slate-500"></i>
                                    <span>Show-up Webinar (%)</span>
                                </label>
                                <input type="number" id="showup" value="40" min="0" max="100" step="1"
                                    class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-4 focus:ring-cyan-100 focus:border-cyan-500 transition-all duration-200 outline-none hover:border-slate-300">
                            </div>
                            
                            <div class="group">
                                <label class="flex items-center space-x-2 text-sm font-medium text-slate-700 mb-2">
                                    <i data-lucide="calendar-check" class="w-4 h-4 text-slate-500"></i>
                                    <span>Conv. Appuntamenti (%)</span>
                                </label>
                                <input type="number" id="convApp" value="30" min="0" max="100" step="1"
                                    class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-4 focus:ring-cyan-100 focus:border-cyan-500 transition-all duration-200 outline-none hover:border-slate-300">
                            </div>
                            
                            <div class="group">
                                <label class="flex items-center space-x-2 text-sm font-medium text-slate-700 mb-2">
                                    <i data-lucide="handshake" class="w-4 h-4 text-slate-500"></i>
                                    <span>Tasso Chiusura Sales (%)</span>
                                </label>
                                <input type="number" id="closeRate" value="50" min="0" max="100" step="1"
                                    class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-4 focus:ring-cyan-100 focus:border-cyan-500 transition-all duration-200 outline-none hover:border-slate-300">
                            </div>
                        </div>
                        
                        <!-- Funnel Preview -->
                        <div class="mt-8 bg-gradient-to-br from-cyan-50 to-blue-50 rounded-xl p-6 border-2 border-cyan-200">
                            <h4 class="text-lg font-semibold text-slate-800 mb-4 flex items-center space-x-2">
                                <i data-lucide="filter" class="w-5 h-5 text-cyan-600"></i>
                                <span>Funnel di Conversione</span>
                            </h4>
                            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                                <div class="bg-white rounded-lg p-4 shadow-md">
                                    <div class="text-xs font-medium text-slate-500 mb-1 flex items-center space-x-1">
                                        <i data-lucide="user-plus" class="w-3 h-3"></i>
                                        <span>Numero Leads</span>
                                    </div>
                                    <div id="numLeads" class="text-2xl font-bold text-primary-700">0</div>
                                </div>
                                <div class="bg-white rounded-lg p-4 shadow-md">
                                    <div class="text-xs font-medium text-slate-500 mb-1 flex items-center space-x-1">
                                        <i data-lucide="video" class="w-3 h-3"></i>
                                        <span>Presenti Webinar</span>
                                    </div>
                                    <div id="numPresenti" class="text-2xl font-bold text-primary-700">0</div>
                                </div>
                                <div class="bg-white rounded-lg p-4 shadow-md">
                                    <div class="text-xs font-medium text-slate-500 mb-1 flex items-center space-x-1">
                                        <i data-lucide="calendar" class="w-3 h-3"></i>
                                        <span>Appuntamenti Sales</span>
                                    </div>
                                    <div id="numApp" class="text-2xl font-bold text-primary-700">0</div>
                                </div>
                                <div class="bg-white rounded-lg p-4 shadow-md">
                                    <div class="text-xs font-medium text-slate-500 mb-1 flex items-center space-x-1">
                                        <i data-lucide="trophy" class="w-3 h-3"></i>
                                        <span>Clienti Acquisiti</span>
                                    </div>
                                    <div id="numClienti" class="text-2xl font-bold text-cyan-600">0.00</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Economic Section -->
                    <div class="space-y-6">
                        <div class="flex items-center space-x-3 pb-3 border-b-2 border-green-500">
                            <i data-lucide="euro" class="w-6 h-6 text-green-600"></i>
                            <h3 class="text-xl font-semibold text-slate-800">Sezione Economica</h3>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="group">
                                <label class="flex items-center space-x-2 text-sm font-medium text-slate-700 mb-2">
                                    <i data-lucide="receipt" class="w-4 h-4 text-slate-500"></i>
                                    <span>Scontrino Medio (€)</span>
                                </label>
                                <input type="number" id="avgTicket" value="1000" min="0" step="10"
                                    class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-4 focus:ring-cyan-100 focus:border-cyan-500 transition-all duration-200 outline-none hover:border-slate-300">
                            </div>
                            
                            <div class="group">
                                <label class="flex items-center space-x-2 text-sm font-medium text-slate-700 mb-2">
                                    <i data-lucide="percent" class="w-4 h-4 text-slate-500"></i>
                                    <span>Costo del Servizio (%)</span>
                                </label>
                                <input type="number" id="costoServizio" value="20" min="0" max="100" step="1"
                                    class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-4 focus:ring-cyan-100 focus:border-cyan-500 transition-all duration-200 outline-none hover:border-slate-300">
                            </div>
                            
                            <div class="group">
                                <label class="flex items-center space-x-2 text-sm font-medium text-slate-700 mb-2">
                                    <i data-lucide="file-text" class="w-4 h-4 text-slate-500"></i>
                                    <span>Costi Fissi Mensili/Campagna (€)</span>
                                </label>
                                <input type="number" id="costiFissi" value="2000" min="0" step="100"
                                    class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-4 focus:ring-cyan-100 focus:border-cyan-500 transition-all duration-200 outline-none hover:border-slate-300">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Operational Section -->
                    <div class="space-y-6">
                        <div class="flex items-center space-x-3 pb-3 border-b-2 border-purple-500">
                            <i data-lucide="briefcase" class="w-6 h-6 text-purple-600"></i>
                            <h3 class="text-xl font-semibold text-slate-800">Sezione Operativa</h3>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="group">
                                <label class="flex items-center space-x-2 text-sm font-medium text-slate-700 mb-2">
                                    <i data-lucide="clock" class="w-4 h-4 text-slate-500"></i>
                                    <span>Durata Appuntamento (min)</span>
                                </label>
                                <input type="number" id="durataApp" value="30" min="1" step="5"
                                    class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-4 focus:ring-cyan-100 focus:border-cyan-500 transition-all duration-200 outline-none hover:border-slate-300">
                            </div>
                            
                            <div class="group">
                                <label class="flex items-center space-x-2 text-sm font-medium text-slate-700 mb-2">
                                    <i data-lucide="calendar-days" class="w-4 h-4 text-slate-500"></i>
                                    <span>Disponibilità commerciale (Ore/webinar)</span>
                                </label>
                                <input type="number" id="oreDisponibili" value="8" min="0" step="0.5"
                                    class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-4 focus:ring-cyan-100 focus:border-cyan-500 transition-all duration-200 outline-none hover:border-slate-300">
                            </div>
                            
                            <div class="group">
                                <label class="flex items-center space-x-2 text-sm font-medium text-slate-700 mb-2">
                                    <i data-lucide="user-check" class="w-4 h-4 text-slate-500"></i>
                                    <span>Tasso Show-up Appuntamenti (%)</span>
                                </label>
                                <input type="number" id="showupApp" value="80" min="0" max="100" step="1"
                                    class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-4 focus:ring-cyan-100 focus:border-cyan-500 transition-all duration-200 outline-none hover:border-slate-300">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Export Button -->
                    <div class="pt-6 border-t border-slate-200">
                        <button id="exportBtn" 
                            class="w-full md:w-auto gradient-accent text-white px-8 py-4 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 flex items-center justify-center space-x-2 group">
                            <i data-lucide="download" class="w-5 h-5 group-hover:animate-bounce"></i>
                            <span>Esporta Scenario</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- KPI Results Section -->
        <section class="animate-slide-in" style="animation-delay: 0.2s;">
            <div class="bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden">
                <div class="bg-gradient-to-r from-cyan-600 to-teal-600 px-6 py-5">
                    <div class="flex items-center space-x-3">
                        <div class="bg-white/20 p-2 rounded-lg">
                            <i data-lucide="bar-chart-3" class="w-6 h-6 text-white"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-white">2. Risultati (KPI)</h2>
                    </div>
                </div>
                
                <div class="p-6 lg:p-8">
                    
                    <!-- Primary KPI - Profit -->
                    <div class="mb-8 bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl p-8 border-2 border-green-200 shadow-lg card-hover">
                        <div class="flex items-start justify-between flex-wrap gap-4">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-3">
                                    <div class="bg-green-500 p-3 rounded-xl shadow-md">
                                        <i data-lucide="trending-up" class="w-7 h-7 text-white"></i>
                                    </div>
                                    <h3 class="text-xl font-bold text-slate-800">Utile Netto Stimato</h3>
                                </div>
                                <div id="profitto" class="text-5xl lg:text-6xl font-bold text-green-600 mb-2">€ 0,00</div>
                                <p class="text-sm text-slate-600">(Fatturato - Costi Servizio - ADV - Costi Fissi)</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Secondary KPIs Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200 card-hover">
                            <div class="flex items-center space-x-3 mb-3">
                                <div class="bg-blue-500 p-2.5 rounded-lg">
                                    <i data-lucide="wallet" class="w-5 h-5 text-white"></i>
                                </div>
                                <h4 class="text-sm font-semibold text-slate-700">Fatturato</h4>
                            </div>
                            <div id="fatturato" class="text-3xl font-bold text-blue-600">€ 0</div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 border border-purple-200 card-hover">
                            <div class="flex items-center space-x-3 mb-3">
                                <div class="bg-purple-500 p-2.5 rounded-lg">
                                    <i data-lucide="repeat" class="w-5 h-5 text-white"></i>
                                </div>
                                <h4 class="text-sm font-semibold text-slate-700">ROAS</h4>
                            </div>
                            <div id="roas" class="text-3xl font-bold text-purple-600">0x</div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-orange-50 to-amber-50 rounded-xl p-6 border border-orange-200 card-hover">
                            <div class="flex items-center space-x-3 mb-3">
                                <div class="bg-orange-500 p-2.5 rounded-lg">
                                    <i data-lucide="target" class="w-5 h-5 text-white"></i>
                                </div>
                                <h4 class="text-sm font-semibold text-slate-700">CAC</h4>
                            </div>
                            <div id="cac" class="text-3xl font-bold text-orange-600">€ 0</div>
                        </div>
                    </div>
                    
                    <!-- Operational Sustainability -->
                    <div class="bg-gradient-to-br from-slate-50 to-gray-50 rounded-xl p-6 border border-slate-300">
                        <div class="flex items-center space-x-3 mb-4">
                            <div class="bg-slate-600 p-2.5 rounded-lg">
                                <i data-lucide="users-round" class="w-5 h-5 text-white"></i>
                            </div>
                            <h3 class="text-lg font-bold text-slate-800">Sostenibilità Operativa</h3>
                        </div>
                        <div class="flex items-baseline space-x-2">
                            <span class="text-sm font-medium text-slate-600">Commerciali Necessari:</span>
                            <span id="salesmen" class="text-4xl font-bold text-slate-700">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
    </main>
    
    <!-- Footer -->
    <footer class="mt-16 pb-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center text-slate-500 text-sm">
                <p class="flex items-center justify-center space-x-2">
                    <i data-lucide="sparkles" class="w-4 h-4"></i>
                    <span>Simulatore di Scenari © 2025</span>
                </p>
            </div>
        </div>
    </footer>

    <script>
        // Initialize Lucide Icons
        lucide.createIcons();
        
        // Get all input fields
        const adv = document.getElementById('adv');
        const cpl = document.getElementById('cpl');
        const showup = document.getElementById('showup');
        const convApp = document.getElementById('convApp');
        const closeRate = document.getElementById('closeRate');
        const avgTicket = document.getElementById('avgTicket');
        const costoServizio = document.getElementById('costoServizio');
        const costiFissi = document.getElementById('costiFissi');
        const durataApp = document.getElementById('durataApp');
        const oreDisponibili = document.getElementById('oreDisponibili');
        const showupApp = document.getElementById('showupApp');

        // Get all output fields
        const numLeads = document.getElementById('numLeads');
        const numPresenti = document.getElementById('numPresenti');
        const numApp = document.getElementById('numApp');
        const numClienti = document.getElementById('numClienti');
        const fatturato = document.getElementById('fatturato');
        const profitto = document.getElementById('profitto');
        const roas = document.getElementById('roas');
        const cac = document.getElementById('cac');
        const salesmen = document.getElementById('salesmen');

        function calcolaKPI() {
            // Input values
            const advVal = parseFloat(adv.value) || 0;
            const cplVal = parseFloat(cpl.value) || 0.01;
            const showupVal = parseFloat(showup.value) / 100 || 0;
            const convAppVal = parseFloat(convApp.value) / 100 || 0;
            const closeRateVal = parseFloat(closeRate.value) / 100 || 0;
            const avgTicketVal = parseFloat(avgTicket.value) || 0;
            const costoServizioVal = parseFloat(costoServizio.value) / 100 || 0;
            const costiFissiVal = parseFloat(costiFissi.value) || 0;
            const durataAppVal = parseFloat(durataApp.value) || 1;
            const oreDisponibiliVal = parseFloat(oreDisponibili.value) || 0;
            const showupAppVal = parseFloat(showupApp.value) / 100 || 0;

            // Funnel calculations
            const leads = advVal / cplVal;
            const presenti = leads * showupVal;
            const appuntamenti = presenti * convAppVal;
            const appEffettivi = appuntamenti * showupAppVal;
            const clienti = appEffettivi * closeRateVal;

            // Economic calculations
            const fatturatoVal = clienti * avgTicketVal;
            const costiServizio = fatturatoVal * costoServizioVal;
            const utileNetto = fatturatoVal - costiServizio - advVal - costiFissiVal;
            const roasVal = advVal > 0 ? fatturatoVal / advVal : 0;
            const cacVal = clienti > 0 ? advVal / clienti : 0;

            // Operational calculations
            const minutiTotali = appEffettivi * durataAppVal;
            const oreTotali = minutiTotali / 60;
            const salesmenNeeded = oreDisponibiliVal > 0 ? Math.ceil(oreTotali / oreDisponibiliVal) : 0;

            // Update display
            numLeads.textContent = Math.round(leads).toLocaleString('it-IT');
            numPresenti.textContent = Math.round(presenti).toLocaleString('it-IT');
            numApp.textContent = Math.round(appuntamenti).toLocaleString('it-IT');
            numClienti.textContent = clienti.toFixed(2);
            
            fatturato.textContent = '€ ' + Math.round(fatturatoVal).toLocaleString('it-IT');
            
            // Color-code profit
            const profitDisplay = utileNetto.toLocaleString('it-IT', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            profitto.textContent = '€ ' + profitDisplay;
            if (utileNetto >= 0) {
                profitto.classList.remove('text-red-600');
                profitto.classList.add('text-green-600');
            } else {
                profitto.classList.remove('text-green-600');
                profitto.classList.add('text-red-600');
            }
            
            roas.textContent = roasVal.toFixed(2) + 'x';
            cac.textContent = '€ ' + Math.round(cacVal).toLocaleString('it-IT');
            salesmen.textContent = salesmenNeeded;
        }

        // Add event listeners to all inputs
        const inputs = [adv, cpl, showup, convApp, closeRate, avgTicket, costoServizio, costiFissi, durataApp, oreDisponibili, showupApp];
        inputs.forEach(input => {
            input.addEventListener('input', calcolaKPI);
        });

        // Export functionality
        document.getElementById('exportBtn').addEventListener('click', function() {
            const scenario = {
                parametri: {
                    marketing: {
                        investimentoAdv: parseFloat(adv.value),
                        costoPerLead: parseFloat(cpl.value),
                        showupWebinar: parseFloat(showup.value),
                        conversioneAppuntamenti: parseFloat(convApp.value),
                        tassoChiusuraSales: parseFloat(closeRate.value)
                    },
                    economici: {
                        scontrinoMedio: parseFloat(avgTicket.value),
                        costoServizio: parseFloat(costoServizio.value),
                        costiFissi: parseFloat(costiFissi.value)
                    },
                    operativi: {
                        durataAppuntamento: parseFloat(durataApp.value),
                        disponibilitaCommerciale: parseFloat(oreDisponibili.value),
                        showupAppuntamenti: parseFloat(showupApp.value)
                    }
                },
                risultati: {
                    funnel: {
                        leads: numLeads.textContent,
                        presentiWebinar: numPresenti.textContent,
                        appuntamenti: numApp.textContent,
                        clienti: numClienti.textContent
                    },
                    kpi: {
                        fatturato: fatturato.textContent,
                        utileNetto: profitto.textContent,
                        roas: roas.textContent,
                        cac: cac.textContent,
                        commercialiNecessari: salesmen.textContent
                    }
                },
                dataEsportazione: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(scenario, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'scenario_' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // Initial calculation
        calcolaKPI();
    </script>
</body>
</html>
